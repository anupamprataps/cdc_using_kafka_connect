version: '3'
services:
 broker:
   image: apache/kafka:latest
   hostname: broker
   container_name: broker
   ports:
     - 9092:9092
   environment:
     KAFKA_BROKER_ID: 1
     KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT,CONTROLLER:PLAINTEXT
     KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092
     KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
     KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
     KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
     KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
     KAFKA_PROCESS_ROLES: broker,controller
     KAFKA_NODE_ID: 1
     KAFKA_CONTROLLER_QUORUM_VOTERS: 1@broker:29093
     KAFKA_LISTENERS: PLAINTEXT://broker:29092,CONTROLLER://broker:29093,PLAINTEXT_HOST://0.0.0.0:9092
     KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
     KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
     KAFKA_LOG_DIRS: /tmp/kraft-combined-logs
     CLUSTER_ID: MkU3OEVBNTcwNTJENDM2Qk
     KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"


 schema-registry:
   image: confluentinc/cp-schema-registry:latest
   container_name: schema-registry
   ports:
     - 8081:8081
   environment:
     SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: "broker:29092"
     SCHEMA_REGISTRY_LISTENER_HTTP_PORT: 8081
     SCHEMA_REGISTRY_HOST_NAME: "localhost"
     SCHEMA_REGISTRY_KAFKASTORE_TOPIC: "_schemas"
     SCHEMA_REGISTRY_ACCESS_CONTROL_ALLOW_ORIGIN: "*"


 connect:
   build: .
   container_name: kafka-connect
   depends_on:
     - broker
     - schema-registry
   ports:
     - 8085:8083
   environment:
     CONNECT_PLUGIN_PATH: /usr/share/java,/usr/share/confluent-hub-components
     CONNECT_BOOTSTRAP_SERVERS: broker:29092
     CONNECT_GROUP_ID: "connect-cluster"
     CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR: 1
     CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR: 1
     CONNECT_STATUS_STORAGE_REPLICATION_FACTOR: 1
     CONNECT_CONFIG_STORAGE_TOPIC: "_connect-configs"
     CONNECT_OFFSET_STORAGE_TOPIC: "_connect-offsets"
     CONNECT_STATUS_STORAGE_TOPIC: "_connect-status"
     CONNECT_KEY_CONVERTER: "org.apache.kafka.connect.storage.StringConverter"
     CONNECT_VALUE_CONVERTER: "io.confluent.connect.avro.AvroConverter"
     CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL: "http://schema-registry:8081"  # Updated to the correct name
     CONNECT_LOG4J_ROOT_LOGLEVEL: "INFO"
     CONNECT_REST_ADVERTISED_HOST_NAME: "localhost"
     CONNECT_REST_LISTENER: "http://0.0.0.0:8083"
networks:
 kafka_network:
   driver: bridge
